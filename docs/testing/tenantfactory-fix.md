# TenantFactory Fix - Reasoning

## Problem

The `TenantFactory` is generating a random `slug` from a random company name, even when the test specifies a `name` attribute. This causes tests to fail because:

1. Test creates tenant with `name => 'Test Tenant'`
2. Factory generates random company name (e.g., 'Rutherford Ltd')
3. Factory generates slug from random name: `Str::slug('Rutherford Ltd')` = `'rutherford-ltd'`
4. Test expects slug to be `Str::slug('Test Tenant')` = `'test-tenant'`
5. **Mismatch!**

## Root Cause

In Laravel factories, the `definition()` method runs FIRST, then the attributes passed to `create()` are merged. However, the slug is being generated from the factory's random `$name`, not from the merged attributes.

## Solution

The factory should NOT generate the slug in `definition()`. Instead:
1. Remove `slug` from factory definition
2. Let the model's `HasSlug` trait generate it automatically from the `name`
3. Or use a `state()` method for specific test scenarios

## Implementation

Remove the `slug` generation from the factory definition. The `Tenant` model uses `HasSlug` trait which will automatically generate the slug from the `name` attribute when the model is saved.

```php
public function definition(): array
{
    return [
        'id' => $this->faker->uuid(),
        'name' => $this->faker->company(),
        // slug will be auto-generated by HasSlug trait
        'domain' => $this->faker->domainName(),
        'database' => $this->faker->word(),
        'is_active' => $this->faker->boolean(),
    ];
}
```

This way:
- When test specifies `name => 'Test Tenant'`, the slug will be auto-generated as `'test-tenant'`
- When test doesn't specify name, factory generates random company name and slug is auto-generated from it
- **Consistent behavior!**

## Alternative: State Method

If we need specific slug values for certain tests, we can add a state method:

```php
public function withName(string $name): static
{
    return $this->state(fn (array $attributes) => [
        'name' => $name,
        // slug will be auto-generated
    ]);
}
```

Usage in tests:
```php
$tenant = Tenant::factory()->withName('Test Tenant')->create();
```

## Conclusion

**Fix the factory, not the tests.** The factory is generating incorrect data. The model's `HasSlug` trait should handle slug generation automatically.
